<html>
<head>
    <title>?</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
        overflow: hidden;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        background-color:black!important;
        color: gray!important;
        line-height:1.1!important;
        font-family:Arial,Helvetica,sans-serif !important;
        }

        #view {
        float: right;
        width: 75%;
        height: 100%;
        }

        #sidebar {
        position: absolute;
        float: left;
        height: 100%;
        width: 25%;
        font-size: 100%;
        /*background-color: black;*/
        margin: 0 !important;
        }


        /*TODO move to ui.slider.css */
        input[type=range].tagSlider {
        -webkit-appearance: none;
        width: 100%;
        margin: 9.8px 0;
        }
        input[type=range].tagSlider:focus {
        outline: none;
        }
        input[type=range].tagSlider::-webkit-slider-runnable-track {
        width: 100%;
        height: 9.4px;
        cursor: pointer;
        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
        background: #484d4d;
        border-radius: 0px;
        border: 0px solid #010101;
        }
        input[type=range].tagSlider::-webkit-slider-thumb {
        box-shadow: 0px 0px 1px #670000, 0px 0px 0px #810000;
        border: 0px solid #ff1e00;
        height: 29px;
        width: 18px;
        border-radius: 0px;
        background: #8ad445;
        cursor: pointer;
        -webkit-appearance: none;
        margin-top: -9.8px;
        }
        input[type=range].tagSlider:focus::-webkit-slider-runnable-track {
        background: #484d4d;
        }
        input[type=range].tagSlider::-moz-range-track {
        width: 100%;
        height: 9.4px;
        cursor: pointer;
        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
        background: #484d4d;
        border-radius: 0px;
        border: 0px solid #010101;
        }
        input[type=range].tagSlider::-moz-range-thumb {
        box-shadow: 0px 0px 1px #670000, 0px 0px 0px #810000;
        border: 0px solid #ff1e00;
        height: 29px;
        width: 18px;
        border-radius: 0px;
        background: #8ad445;
        cursor: pointer;
        }
        input[type=range].tagSlider::-ms-track {
        width: 100%;
        height: 9.4px;
        cursor: pointer;
        background: transparent;
        border-color: transparent;
        color: transparent;
        }
        input[type=range].tagSlider::-ms-fill-lower {
        background: #484d4d;
        border: 0px solid #010101;
        border-radius: 0px;
        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
        }
        input[type=range].tagSlider::-ms-fill-upper {
        background: #484d4d;
        border: 0px solid #010101;
        border-radius: 0px;
        box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
        }
        input[type=range].tagSlider::-ms-thumb {
        box-shadow: 0px 0px 1px #670000, 0px 0px 0px #810000;
        border: 0px solid #ff1e00;
        height: 29px;
        width: 18px;
        border-radius: 0px;
        background: #8ad445;
        cursor: pointer;
        height: 9.4px;
        }
        input[type=range].tagSlider:focus::-ms-fill-lower {
        background: #484d4d;
        }
        input[type=range].tagSlider:focus::-ms-fill-upper {
        background: #484d4d;
        }

    </style>
</head>

<body>
<div id="sidebar" class="ui inverted menu"></div>
</body>

<script>
    function ready() {


        var app = {

            index: { },
            focus: { },

            setFocus: function(tag, amount) {
                var prevFocus = this.focus[tag] || 0;
                if (prevFocus == amount) return;

                this.focus[tag] = amount;

                var t = this.index.tag.node(tag);

                if (prevFocus == 0) {
                    //add focus

                    var c = t.newChannel();
                    t._channel = c; //the default, we'll store there

                    console.log('ON: ', tag, t, c);
                }
                else if (amount == 0) {
                    //remove focus
                    if (t._channel) {
                        if (t._channel.off)
                            t._channel.off();
                    }
                    console.log('OFF: ', tag, t, c);
                    delete this.focus[tag];
                }
                else {
                    //change focus
                }

                console.log(app.focus);

            },

            views: {
                'graph': new GraphView(),
                'map2d': new Map2DView(),
                'map3d': new Map3DView(),
                'wikipedia': new WikipediaView('Happiness'),
                'space1': new HTMLView('Spaces Test', 'lab', 'space.html')

            },

            setView: function(v, cb) {

                if (this.currentView) {
                    try {
                        this.currentView.stop();
                    }
                    catch (e) {
                        console.error(e);
                        notify(JSON.stringify(e));
                    }
                    $('#view').remove();
                }

                this.currentView = this.views[v];

                if (this.currentView) {
                    var viewTarget = $('<div id="view"></div>');
                    $('body').append(viewTarget);
                    try {
                        this.currentView.start(viewTarget, cb);
                    }
                    catch (e) {
                        console.trace();
                        console.error(e);
                        viewTarget.html('ERROR setView(' + v + '): ' + e);
                    }
                }

            },

            newViewControl : function() {
                //http://semantic-ui.com/elements/button.html#colored-group
                /*<div class="large ui buttons">
                 <div class="ui button">One</div>
                 <div class="ui button">Two</div>
                 <div class="ui button">Three</div>
                 </div>
                 */
                var that = this;

                var d = $('<div class="ui buttons inverted">');
                _.each(that.views, function(v, k) {
                    d.append($('<div class="ui icon button"></div>').append($('<i class="' + v.icon + ' icon"></i>'))
                        /*.attr('data-content', v.name)
                         .popup()*/
                            .click(function() {
                                //setTimeout(function() {
                                    that.setView(k);
                                //}, 0);
                            }));
                });
                return d;

            }

        };

        window.app = app; //for console access

        Backbone.Router.extend({

            routes: {
//                "help":                 "help",    // #help
//                "search/:query":        "search",  // #search/kiwis
//                "search/:query/p:page": "search"   // #search/kiwis/p7
            }


//            help: function() {
//
//            },
//
//            search: function(query, page) {
//
//            }

        });
        Backbone.history.start({pushState: true});



        $('#sidebar').append(app.newViewControl());

        app.index = new TagIndex(function (i) {

            var t = new TagIndexAccordion(i);

            t.newElementHeader = function(tag) {

                //http://codepen.io/thehonestape/pen/yjlGi
                //http://thecodeplayer.com/walkthrough/spicing-up-the-html5-range-slider-input

                var d = newDiv();
                var ii = $('<input class="tagSlider" type = "range" value="0" min="0" max="100" _onchange="rangevalue.value=value"/>');
                ii.change(function(c) {
                    app.setFocus(tag, parseInt(ii.val()) * 0.01);
                });
                d.html(ii);
                return d;
            };

            $('#sidebar').append(t);

        });

    }




</script>

<link type="text/css" rel="stylesheet" href="spacegraph.dark.css"/>
<script src="spacegraph.demo.js"></script>

<script src="view.js"></script>

<link type="text/css" rel="stylesheet" href="view.wikipedia.css"/>
<script src="view.wikipedia.js"></script>


<link rel="import" onload="ready()" href="head.html">
<link rel="import" href="head.leaflet.html">


</html>
